# === DATABASE (cho app) ===
DB_SCHEME=mysql+pymysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_NAME=smartsurvey
DB_USER=root
DB_PASS=123456

# === DATABASE (duy nhất) ===
DATABASE_URL=mysql+pymysql://root:123456@127.0.0.1:3306/smartsurvey

# === RUNTIME FLAGS (giữ nguyên) ===
NEUTRAL_THRESHOLD=0.6
WRITE_INFERENCES=1
USE_KNN_CACHE=1

# === API (dùng cho script checklist / Swagger) ===
BASE_URL=http://127.0.0.1:8000
API_KEY=dev-local-123
# Chọn survey bạn muốn chạy:
SURVEY_ID=1 #có thể thay đổi survey_id để có thể kiếm tra 

# === MYSQL cho các script CLI (không ảnh hưởng app) ===
MYSQL_HOST=127.0.0.1
MYSQL_PORT=3306
MYSQL_DB=smartsurvey
MYSQL_USER=root
MYSQL_PWD=123456

# Gemini
EXT_SUMM_URL=https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent
EXT_SENTI_URL=https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent
EXT_SENTI_KEY=AIzaSyAs2Ssb5ml4cJPw7OKWMKo9TLSRkt1s4ns
EXT_SENTI_LANG=vi

# Giới hạn & ổn định
SUMMARY_MAX_RESP=200                # số phản hồi đưa vào tóm tắt
SUMMARY_MAX_CHARS=12000               # số ký tự gửi qua Gemini
EXT_SENTI_TIMEOUT=12.0               # giây
EXT_SENTI_MAX_RETRY=4

# dùng Gemini cho basic sentiment
FORCE_EXTERNAL_SENTI=1


# Batch để giảm 429
SENTI_BATCH_SIZE=50
SENTI_BACKOFF_BASE=1.2


CACHE_CLASSIFY_MAX=20000
CACHE_CLASSIFY_TTL=86400
CACHE_SUMMARY_MAX=2000
CACHE_SUMMARY_TTL=86400
CB_FAILS=6 #8
CB_COOLDOWN=45 #30
RL_CLASSIFY_RPS=2 #5
RL_CLASSIFY_BURST=8 #10
RL_SUMMARY_RPS=1
RL_SUMMARY_BURST=2
AB_TRAFFIC_B=20

# Gemini Embeddings
EXT_EMB_URL=https://generativelanguage.googleapis.com/v1beta/models/text-embedding-004:embedContent
EXT_EMB_KEY=AIzaSyAs2Ssb5ml4cJPw7OKWMKo9TLSRkt1s4ns
EXT_EMB_MODEL=text-embedding-004
EXT_EMB_DIM=768

# RAG params
RAG_TOP_K=5
RAG_MAX_CTX_CHARS=5000

RAG_MIN_SIM=0.25          # lọc context yếu trước khi nhồi vào prompt
USE_HTTPX_WRAPPER=1       # (nếu muốn bật/tắt wrapper nhanh)


# === ChromaDB (Persistent vector store) ===
CHROMA_DB_PATH=./chroma_db
CHROMA_COLLECTION=survey_answers

# === Batch sizes (tối ưu I/O & RAM) ===
RAG_INGEST_BATCH=200     # batch khi gọi /ai/rag/ingest/{survey_id}
MIGRATE_BATCH=1000       # batch khi chạy migrate_chroma.py
EMBED_MAX_WORKERS=1     #8

RUN_AUTO_INGEST=1            # 1 để bật loop ingest nền cho các survey active
AUTO_INGEST_INTERVAL_SEC=600 # chu kỳ ingest nền (10 phút)

MIGRATE_ON_BOOT=1           # 1 nếu muốn app tự chạy migrate_chroma.py khi start


# OpenAI (CHỈ cho /ai/chat)
OPENAI_API_KEY=input_key
OPENAI_CHAT_MODEL=gpt-4o-mini
OPENAI_MAX_OUTPUT_TOKENS=450


